{{define "createStressTool"}}
    <!-- 创建测试任务 -->
    <div id="createStressTool">
        <div style="display: inline-block; max-width: 40%">
            <div class="input-group input-group-lg top-pad-1" >
                <span class="input-group-addon">测试机器IP或域名<span class="must-fill">*</span></span>
                <span class="input-group-addon error hidden" id="targetAddressErr">error</span>
                <input type="text" class="form-control" id="targetAddress" aria-describedby="sizing-addon1">
            </div>
        </div>
        <div class="left-margin-1" style="display: inline-block; max-width: 20%">
            <div class="input-group input-group-lg top-pad-1">
                <span class="input-group-addon" >测试机器端口<span class="must-fill">*</span></span>
                <span class="input-group-addon error hidden" id="targetPortErr">error</span>
                <input type="text" class="form-control" id="targetPort" aria-describedby="sizing-addon1">
            </div>
        </div>

        <div class="left-margin-1" style="display: inline-block;">
            <div class="input-group input-group-lg top-pad-1">
                <button class="btn btn-default btn-lg" onclick="testConnected()">测试连通性</button>
            </div>
        </div>
        <div class="input-group input-group-lg  top-pad-1">
            <span class="input-group-addon">连接超时时间（ms）</span>
            <span class="input-group-addon error hidden" id="timeoutErr">error</span>
            <input type="text" class="form-control" id="timeout" aria-describedby="sizing-addon1">
        </div>
        <div class="input-group input-group-lg  top-pad-1">
            <span class="input-group-addon">线程数<span class="must-fill">*</span></span>
            <span class="input-group-addon error hidden" id="threadNumErr">error</span>
            <input type="text" class="form-control" id="threadNum" aria-describedby="sizing-addon1">
        </div>
        <!-- 测试机返回值相关参数 -->
        <div class="input-group input-group-lg top-pad-1  heigh-full">
            <span class="input-group-addon">测试机是否有返回值</span>
            <div class="heigh-full left-margin-1">
                <span onclick="setResponseDetailHidden(false)">
                    <input class="form-check-input middle heigh-full" style="margin: 0 0 0; transform: scale(1.4)"
                           type="radio" name="hasResponseRadio" id="hasResponseRadio1" value="true">
                    <label class="form-check-label text-center heigh-full" style="margin: 0 0 0; font-size: 16px; font-weight: normal"
                           for="hasResponseRadio1">&nbsp;有&nbsp;</label>
                </span>

                <span onclick="setResponseDetailHidden(true)">
                    <input class="form-check-input middle heigh-full" style="margin: 0 0 0; transform: scale(1.4)"
                           type="radio" name="hasResponseRadio" id="hasResponseRadio2" value="false">
                    <label class="form-check-label text-center heigh-full" style="margin: 0 0 0; font-size: 16px; font-weight: normal"
                           for="hasResponseRadio2">&nbsp;无&nbsp;</label>
                </span>
            </div>
        </div>
        <span id="response-detail">
            <div class="input-group input-group-lg  top-pad-1">
                <span class="input-group-addon">读取超时时间（ms）</span>
                <span class="input-group-addon error hidden" id="readTimeoutErr">error</span>
                <input type="text" class="form-control" id="readTimeout" aria-describedby="sizing-addon1" placeholder="10000">
            </div>
            <div class="input-group input-group-lg  top-pad-1">
                <span class="input-group-addon">期望返回字节数（Byte）</span>
                <span class="input-group-addon error hidden" id="expectedBytesErr">error</span>
                <input type="text" class="form-control" id="expectedBytes" aria-describedby="sizing-addon1">
            </div>
        </span>
        <!-- 重复发送的一些参数 -->
        <div class="input-group input-group-lg  top-pad-1 heigh-full">
            <span class="input-group-addon">是否重复发送</span>
            <div class="heigh-full left-margin-1">
                <span onclick="setRepeatSendDetailHidden(false)">
                    <input class="form-check-input middle heigh-full" style="margin: 0 0 0; transform: scale(1.4)"
                           type="radio" name="isRepeatSendRadio" id="isRepeatSendRadio1" value="true">
                    <label class="form-check-label text-center heigh-full" style="margin: 0 0 0; font-size: 16px; font-weight: normal"
                           for="isRepeatSendRadio1">&nbsp;是&nbsp;</label>
                </span>

                <span onclick="setRepeatSendDetailHidden(true)">
                    <input class="form-check-input middle heigh-full" style="margin: 0 0 0; transform: scale(1.4)"
                           type="radio" name="isRepeatSendRadio" id="isRepeatSendRadio2" value="false">
                    <label class="form-check-label text-center heigh-full" style="margin: 0 0 0; font-size: 16px; font-weight: normal"
                           for="isRepeatSendRadio2">&nbsp;否&nbsp;</label>
                </span>
            </div>
        </div>
        <span id="repeat-send-detail">
            <div class="input-group input-group-lg  top-pad-1">
                <span class="input-group-addon">重复发送次数<span class="must-fill">*</span></span>
                <span class="input-group-addon error hidden" id="repeatTimeErr">error</span>
                <input type="text" class="form-control" id="repeatTime" aria-describedby="sizing-addon1">
            </div>
            <div class="input-group input-group-lg  top-pad-1">
                <span class="input-group-addon">重复发送间隔（ms）</span>
                <span class="input-group-addon error hidden" id="intervalTimeErr">error</span>
                <input type="text" class="form-control" id="intervalTime" aria-describedby="sizing-addon1">
            </div>
        </span>
        <!-- 请求数据相关参数 -->
        <div class="input-group input-group-lg top-pad-1">
            <span class="input-group-addon">请求数据格式<span class="must-fill">*</span></span>
            <button type="button" class="btn btn-default btn-lg left-margin-1" onclick="addInputData()">添加数据</button>
        </div>
        <span id="input-data-parent">
        </span>
        <div class="input-group input-group-lg top-pad-1">
            <button type="button" class="btn btn-default btn-lg" style="background-color: #C6F089;" onclick="createTaskOrSave(true)">创建任务</button>
            <button type="button" class="btn btn-default btn-lg left-margin-1" onclick="saveTaskBtnClick()">存储任务</button>
            <button type="button" class="btn btn-default btn-lg left-margin-1" onclick="querySaveTaskClick()">查询任务</button>
        </div>
        <!-- 存储任务要输入的名称 -->
        <div id="saveTaskBox" style="display: none; position: fixed; top: 32%; left: 35%; z-index: 20; height: 25%; width: 22%; border-radius: 20px; background-color: whitesmoke;">
            <div class="input-group input-group-lg" style="position: relative; top: 18%; padding: 10px;">
                <span class="input-group-addon">任务别名</span>
                <input type="text" class="form-control" id="saveTaskTag" aria-describedby="sizing-addon1">
            </div>
            <div class="input-group input-group-lg" style="position: relative; top: 25%; padding: 10px; display: flex; justify-content: center;">
                <button type="button" class="btn btn-default btn-lg" style="background-color: #C6F089;" onclick="saveTaskBoxConfirm()">保存</button>
                <button type="button" class="btn btn-default btn-lg left-margin-1" onclick="saveTaskBoxCancel()">取消</button>
            </div>
        </div>
        <!-- 存储的任务列表 -->
        <div id="saveTaskBoxList" style="display: none; position: fixed; top: 0; left: 0; right: 0; width: 60%; height: 95%; margin: 20px auto;
                    background-color: whitesmoke; border-radius: 7px; z-index: 20; overflow: scroll; overflow-x: hidden; overflow-y: auto;">

        </div>
    </div>
    <script>
        // 默认选有
        $("#hasResponseRadio1").attr("checked", "checked");
        $("#hasResponseRadio2").removeAttr("checked");
        setResponseDetailHidden(false)

        $("#isRepeatSendRadio1").attr("checked","checked");
        $("#isRepeatSendRadio2").removeAttr("checked");
        setRepeatSendDetailHidden(false)

        function setResponseDetailHidden(isHidden) {
            if (isHidden) {
                $("#response-detail").hide(700)
            } else {
                $("#response-detail").show(700)
            }
        }

        function setRepeatSendDetailHidden(isHidden) {
            if (isHidden) {
                $("#repeat-send-detail").hide(700)
            } else {
                $("#repeat-send-detail").show(700)
            }
        }

        function getInputDataElement() {
            var uniqueId = $.getUniqueId()
            return `
                <div class="input-data-top">
                    <input type="hidden" class="input-data-type">
                    <div style="display: inline-block; max-width: 30%">
                        <div class="input-group input-group-lg top-pad-1">
                            <!-- 类型按钮 -->
                            <div class="btn-group" style="float: left;">
                                <button type="button" class="btn btn-default dropdown-toggle btn-lg" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false"  style="width: 160px;">
                                    <span class="dropdown-toggle-text">定义数据类型</span> <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a onclick="inputDataIntChose(this)">Int数据</a></li>
                                    <li><a onclick="inputDataFloatChose(this)">Float数据</a></li>
                                    <li><a onclick="inputDataStringChose(this)">字符串数据</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li><a >取消</a></li>
                                </ul>
                            </div>
                            <!-- 类型长度 -->
                            <span class="input-group-addon left-margin-1" style="float:left; width: 150px">长度（byte）<span class="must-fill">*</span></span>
                            <input type="text" class="form-control input-data-length" style="width: 150px; float: left" name="Data" aria-describedby="sizing-addon1">
                        </div>
                    </div>
                    <div style="display: inline-block; max-width: 50%">
                        <div class="input-group input-group-lg top-pad-1">
                            <!-- 数据 -->
                            <span class="input-group-addon left-margin-1">数据<span class="must-fill">*</span></span>
                            <input type="text" class="form-control input-data-data" name="Data" aria-describedby="sizing-addon1">
                        </div>
                    </div>
                    <!-- 大小端 -->
                    <div style="display: inline-block;" class="left-margin-2 input-data-num-end-parent">
                        <div class="input-group input-group-lg top-pad-1" style="height: 46px; font-size: 18px;">
                            <input type="checkbox" class="pointer input-data-num-end" id="inputDataNumEnd` + uniqueId + `"
                                onclick="inputDataNumEndClick(this)" checked>
                            <label class="pointer input-data-num-end-label" style="margin-left: 5px; font-weight: normal;" for="inputDataNumEnd` + uniqueId + `">大端</label>
                        </div>
                    </div>
                    <div style="display: inline-block; max-width: 10%" class="left-margin-2">
                        <div class="input-group input-group-lg top-pad-1">
                            <!-- 数据 -->
                            <button style="display: inline-block;"
                                class="btn btn-default btn-lg" onclick="deleteElement(this)">删除</button>
                        </div>
                    </div>
                </div>`
        }

        function addInputData() {
            var inputDataHTML = getInputDataElement()
            //$("#input-data-parent").html($("#input-data-parent").html() + inputDataHTML)
            $("#input-data-parent").append($(inputDataHTML))
        }

        function deleteElement(obj) {
            $(obj.parentNode.parentNode.parentNode).remove()
        }

        function hidTestConnectedErr() {
            $("#targetAddressErr").addClass("hidden")
            $("#targetPortErr").addClass("hidden")
        }

        function testConnected() {
            hidTestConnectedErr()
            var address = $("#targetAddress").val()
            var port = $("#targetPort").val()

            $.loadingStart()
            $.ajax({
                url: "/TestConnectivity",
                type: "POST",
                data: JSON.stringify({
                    "targetAddress": address,
                    "targetPort": port
                }),
                dataType: "json",
                contentType: "application/json",
                success: function(data) {
                    $.loadingEnd()
                    if ($.checkResultErr(data)) {
                        var strs = data.resultCode.split(",")
                        for (var i = 0, len = strs.length; i < len; i++) {
                            if (strs[i] == "1001") {
                                $("#targetAddressErr").text("不能为空")
                                $("#targetAddressErr").removeClass("hidden")
                            }
                            if (strs[i] == "1002") {
                                $("#targetPortErr").text("不能为空")
                                $("#targetPortErr").removeClass("hidden")
                            }
                        }
                        return
                    }
                    data = data.data
                    $.showAlertBox(data.result ? "成功": "失败", data.msg, data.result == false)
                },
                error: function (err) {
                    $.loadingEnd()
                    $.showRequestErr(err)
                }
            })
        }

        function inputDataIntChose(obj) {
            var p = $(obj).parents(".input-data-top")[0]
            var inputLength = $(p).find(".input-data-length")[0]
            $(inputLength).attr("placeholder", "只能为1,2,4,8")
            $(inputLength).val("")
            $(inputLength).removeAttr("disabled")
            var inputType = $(p).children(".input-data-type")[0]
            $(inputType).val("0")
            $(p).find(".dropdown-toggle-text")[0].innerText = "Int数据"
            // 大小端复选框
            $(p).find(".input-data-num-end-parent").removeClass("hidden")

            var inputData = $(p).find(".input-data-data")[0]
            //$(inputData).unbind('input', computeBytes)
            $(inputData).unbind('blur')
        }

        function inputDataFloatChose(obj) {
            var p = $(obj).parents(".input-data-top")[0]
            var inputLength = $(p).find(".input-data-length")[0]
            $(inputLength).attr("placeholder", "只能为4,8")
            $(inputLength).val("")
            $(inputLength).removeAttr("disabled")
            var inputType = $(p).children(".input-data-type")[0]
            $(inputType).val("1")
            $(p).find(".dropdown-toggle-text")[0].innerText = "Float数据"
            // 大小端复选框
            $(p).find(".input-data-num-end-parent").removeClass("hidden")

            var inputData = $(p).find(".input-data-data")[0]
            //$(inputData).unbind('input', computeBytes)
            $(inputData).unbind('blur')
        }

        function inputDataNumEndClick(obj) {
            var parent = $(obj).parent()
            var checkbox = $(parent).find(".input-data-num-end")
            $(parent).find(".input-data-num-end-label").text($(checkbox).is(":checked") ? "大端" : "小端")
        }

        /*function computeBytes(event) {
            var objlength = event.data.inputLength
            var objdata = event.data.inputData
            var data = $(objdata).val()

            for (var i = 0; i < data.length; i++) {
                console.log(data.charCodeAt(i))
            }
            //console.log(atob(data))
            $(objlength).val()
        }*/
        function inputDataStringChose(obj) {
            var p = $(obj).parents(".input-data-top")[0]
            var inputLength = $(p).find(".input-data-length")[0]
            $(inputLength).attr("placeholder", "将会自动补充")
            $(inputLength).val("")
            $(inputLength).attr("disabled", "")
            var inputType = $(p).children(".input-data-type")[0]
            $(inputType).val("2")
            $(p).find(".dropdown-toggle-text")[0].innerText = "字符串数据"
            // 大小端复选框
            $(p).find(".input-data-num-end-parent").addClass("hidden")

            var inputData = $(p).find(".input-data-data")[0]
            var lastValue = inputData.value
            $(inputData).bind('blur', function () {
                // input值未变时，不发送请求
                if (lastValue != inputData.value || $(inputLength).val() == "") {
                    lastValue = inputData.value
                    $.ajax({
                        url: "/GetStrBytes",
                        type: "POST",
                        data: inputData.value,
                        success: function(data) {
                            $(inputLength).val(data)
                        },
                        error: function (err) {
                            $.showRequestErr(err)
                        }
                    })
                }
            })
        }

        function clearAllErr() {
            $("#targetAddressErr").addClass("hidden")
            $("#targetPortErr").addClass("hidden")
            $("#timeoutErr").addClass("hidden")
            $("#readTimeoutErr").addClass("hidden")
            $("#expectedBytesErr").addClass("hidden")
            $("#threadNumErr").addClass("hidden")
            $("#repeatTimeErr").addClass("hidden")
            $("#intervalTimeErr").addClass("hidden")
        }

        function saveTaskBtnClick() {
            $.maskShow($("#createStressTool"), 10, function () {
                $.maskRemove()
                $("#saveTaskBox").hide()
            })
            $("#saveTaskBox").show()
        }

        function saveTaskBoxCancel() {
            $.maskRemove()
            $("#saveTaskBox").hide()
            $("#saveTaskTag").val("")
        }
        
        function saveTaskBoxConfirm() {
            createTaskOrSave(false)
        }

        function saveTaskBoxListChooseAllClick() {
            $(".saveTaskSignleChooseCheckbox").prop("checked", $("#saveTaskBoxListChooseAll").is(":checked"))
        }

        function deleteSaveTaskClick() {
            var inputNodeArr = $(".saveTaskSignleChooseCheckbox")
            var deleteSaveTaskIdArr = []
            for (var i = 0, length = inputNodeArr.length; i < length; i++) {
                var item = $(inputNodeArr[i])
                if (item.is(":checked")) {
                    deleteSaveTaskIdArr.push(item.next().val())
                }
            }
            if (deleteSaveTaskIdArr.length == 0) {
                $.showAlertBox("警告", "没有选取任何存储的任务，不能删除")
                return;
            }
            $.showAlertBox("提示", "是否删除选中的存储任务？", false, function () {
                $.loadingStart()
                $.ajax({
                    url: "/DeleteSaveTask",
                    type: "POST",
                    data: JSON.stringify({
                        "saveTaskIdArr": deleteSaveTaskIdArr
                    }),
                    success: function(data) {
                        $.loadingEnd()
                        if ($.checkResultErr(data)) {
                            return
                        }
                        // 删除后刷新任务
                        querySaveTaskClick()
                        data = data.data
                        $.showAlertBox("成功", data)
                    },
                    error: function (err) {
                        $.loadingEnd()
                        $.showRequestErr(err)
                    }
                })
            }, "确定删除")
        }
        function addSaveTaskList(data) {
            var chooseAllText = `
                <div class="top-pad-1">
                    <a class="list-group-item list-group-item-action">
                        <div class="input-group input-group-lg">
                            <input type='checkbox' style='transform: scale(1.2)' class='pointer' id='saveTaskBoxListChooseAll' onclick='saveTaskBoxListChooseAllClick()'>
                            <label class="pointer" for="saveTaskBoxListChooseAll">&nbsp;&nbsp;全选</label>
                        </div>
                    </a>
                </div>
            `
            $("#saveTaskBoxList").append($(chooseAllText))
            for (var i = 0, length = data.length; i < length; i++) {
                var item = data[i]
                var textTemplate = "<div style='display: inline-block; vertical-align: middle; line-height: 34px;'>" +
                    "<input type='checkbox' style='transform: scale(1.2)' class='pointer saveTaskSignleChooseCheckbox'>&nbsp;&nbsp;" +
                    "保存任务id：{saveTaskId}&nbsp;&nbsp;任务名称：{saveTaskTag}&nbsp;&nbsp;" +
                    "地址：{targetAddress}&nbsp;&nbsp;端口：{targetPort}&nbsp;&nbsp;线程数量：{threadNum}&nbsp;&nbsp;保存时间：{saveTime}" +
                    "<input type='hidden' value='{saveTaskId2}'/> " +
                    "</div>"
                item.saveTaskId2 = item.saveTaskId
                var textResult = textTemplate.format(item)
                var node = `
                            <div class="top-pad-1">
                                <a href="#" class="list-group-item list-group-item-action list-group-item-info" style="display: flex; justify-content: space-between;">
                                    ` + textResult + `
                                    <button class="btn btn-default" onclick="loadSaveTaskClick('` + item.saveTaskId + `')">载入任务</button>
                                </a>
                            </div>
                        `
                $("#saveTaskBoxList").append($(node))
            }
            var tailBtnNode  = `
                <button class="btn btn-default btn-lg" style="margin: 10px 10px 10px 10px; float:right; background-color: #FF4848;"
                    onclick="deleteSaveTaskClick()">删除</button>
                <button class="btn btn-default btn-lg" style="margin: 10px 10px 10px 10px; float:right;" onclick="closeSaveTaskBoxList()">返回</button>
            `
            $("#saveTaskBoxList").append($(tailBtnNode))
        }
        function closeSaveTaskBoxList() {
            $.maskRemove()
            $("#saveTaskBoxList").hide()
        }
        function querySaveTaskClick() {
            $.loadingStart()
            $.ajax({
                url: "/GetSaveTaskDesc",
                type: "POST",
                data: {},
                success: function(data) {
                    $.loadingEnd()
                    if ($.checkResultErr(data)) {
                        return
                    }
                    $("#saveTaskBoxList").html("")

                    data = data.data
                    addSaveTaskList(data)

                    $("#saveTaskBoxList").show()
                    $.maskShow($("#createStressTool"), 10, function () {
                        closeSaveTaskBoxList()
                    })
                },
                error: function (err) {
                    $.loadingEnd()
                    $.showRequestErr(err)
                }
            })
        }

        function loadSaveTask(data) {
            $("#targetAddress").val(data.targetAddress)
            $("#targetPort").val(data.targetPort)
            $("#timeout").val(data.timeout)
            $("#threadNum").val(data.threadNum)

            if (data.hasResponse) {
                $("#hasResponseRadio1").attr("checked", "checked");
                $("#hasResponseRadio2").removeAttr("checked");
            } else {
                $("#hasResponseRadio2").attr("checked", "checked");
                $("#hasResponseRadio1").removeAttr("checked");
            }
            setResponseDetailHidden(!data.hasResponse)
            $("#readTimeout").val(data.readTimeout)
            $("#expectedBytes").val(data.expectedBytes)

            if (data.isRepeat) {
                $("#isRepeatSendRadio1").attr("checked","checked");
                $("#isRepeatSendRadio2").removeAttr("checked");
            } else {
                $("#isRepeatSendRadio2").attr("checked","checked");
                $("#isRepeatSendRadio1").removeAttr("checked");
            }
            setRepeatSendDetailHidden(!data.isRepeat)
            $("#repeatTime").val(data.repeatTime)
            $("#intervalTime").val(data.intervalTime)

            $("#input-data-parent").html("")
            for (var i = 0, length = data.dataMapArr.length; i < length; i++) {
                var item = data.dataMapArr[i]
                $("#input-data-parent").append($(getInputDataElement()))
                var node = $(".input-data-top")[i] // 获取到刚才新增的最后一个节点

                var type = $(node).children(".input-data-type")[0]
                var inputLength = $(node).find(".input-data-length")[0]
                var inputData = $(node).find(".input-data-data")[0]
                var isBigEnd = $(node).find(".input-data-num-end")[0]

                switch(item.type) {
                    case "0":
                        inputDataIntChose(type)
                        break;
                    case "1":
                        inputDataFloatChose(type)
                        break;
                    case "2":
                        inputDataStringChose(type)
                        break;
                    default:
                        $.showAlertBox("错误", "未知数据类型", true);
                        return
                }
                inputLength.value = item.length
                inputData.value = item.data
                $(isBigEnd).prop("checked", item.isBigEnd)
                inputDataNumEndClick(type)
            }
        }
        function loadSaveTaskClick(saveTaskId) {
            $.loadingStart()
            $.ajax({
                url: "/GetSaveTaskDetail",
                type: "POST",
                data: JSON.stringify({
                    "saveTaskId": saveTaskId
                }),
                success: function(data) {
                    $.loadingEnd()
                    if ($.checkResultErr(data)) {
                        return
                    }
                    $.maskRemove()
                    $("#saveTaskBoxList").hide()

                    data = data.data.taskData
                    loadSaveTask(data)
                },
                error: function (err) {
                    $.loadingEnd()
                    $.showRequestErr(err)
                }
            })
        }

        // createTaskFlag: true 为创建任务，false 为存储任务
        function createTaskOrSave(createTaskFlag) {
            clearAllErr()
            // 读取数据
            var targetAddress = $("#targetAddress").val()
            var targetPort = $("#targetPort").val()
            var timeout = $("#timeout").val()
            var threadNum = $("#threadNum").val()

            var hasResponse = $('input[name="hasResponseRadio"]:checked').val() == "true"
            var readTimeout = $("#readTimeout").val()
            var expectedBytes = $("#expectedBytes").val()

            var isRepeatSend = $('input[name="isRepeatSendRadio"]:checked').val() == "true"
            var repeatTime = $("#repeatTime").val()
            var intervalTime = $("#intervalTime").val()

            var inputDataMap = []
            var inputDataParent = $("#input-data-parent")
            var inputDataArr = $(inputDataParent).children(".input-data-top")
            for (var i = 0; i < inputDataArr.length; i++) {
                var node = inputDataArr[i]
                var type = $(node).children(".input-data-type")[0].value
                var inputLength = $(node).find(".input-data-length")[0].value
                var inputData = $(node).find(".input-data-data")[0].value
                var isBigEnd = $(node).find(".input-data-num-end")[0].checked
                var obj = {}
                if (type == "") {
                    $.showAlertBox("请检查", "数据类型不能为空", true)
                    return
                }
                if (inputLength == "" && type != "2") {
                    $.showAlertBox("请检查", "数据长度不能为空", true)
                    return
                }
                if (inputData == "") {
                    $.showAlertBox("请检查", "数据不能为空", true)
                    return
                }

                obj.type = type
                obj.length = inputLength
                obj.data = inputData
                obj.isBigEnd = isBigEnd
                inputDataMap.push(obj)
            }

            var sendData = {
                "targetAddress": targetAddress,
                "targetPort": targetPort,
                "timeout": timeout,
                "threadNum": threadNum,
                "hasResponse": hasResponse,
                "readTimeout": readTimeout,
                "expectedBytes": expectedBytes,
                "isRepeat": isRepeatSend,
                "repeatTime": repeatTime,
                "intervalTime": intervalTime,
                "dataMapArr": inputDataMap
            }
            if (!createTaskFlag) {
                // 存储任务
                var saveTaskTag = $("#saveTaskTag").val()
                sendData.saveTaskTag = saveTaskTag
                $.maskRemove()
                $("#saveTaskBox").hide()
                $("#saveTaskTag").val("")
            }
            $.loadingStart()
            $.ajax({
                url: createTaskFlag ? "/CreateTask" : "/SaveTask",
                type: "POST",
                data: JSON.stringify(sendData),
                dataType: "json",
                contentType: "application/json",
                success: function(data) {
                    $.loadingEnd()
                    if ($.checkResultErr(data)) {
                        var strs = data.resultCode.split(",")
                        for (var i = 0, len = strs.length; i < len; i++) {
                            if (strs[i] == "1001") {
                                $("#targetAddressErr").text("不能为空")
                                $("#targetAddressErr").removeClass("hidden")
                            }
                            if (strs[i] == "1002") {
                                $("#targetPortErr").text("不能为空")
                                $("#targetPortErr").removeClass("hidden")
                            }
                            if (strs[i] == "1003") {
                                $("#timeoutErr").text("非法字符或数字超出范围")
                                $("#timeoutErr").removeClass("hidden")
                            }
                            if (strs[i] == "1004") {
                                $("#readTimeoutErr").text("不能为空")
                                $("#readTimeoutErr").removeClass("hidden")
                            }
                            if (strs[i] == "1005") {
                                $("#readTimeoutErr").text("非法字符或数字超出范围")
                                $("#readTimeoutErr").removeClass("hidden")
                            }
                            if (strs[i] == "1006") {
                                $("#expectedBytesErr").text("不能为空")
                                $("#expectedBytesErr").removeClass("hidden")
                            }
                            if (strs[i] == "1007") {
                                $("#expectedBytesErr").text("非法字符或数字超出范围")
                                $("#expectedBytesErr").removeClass("hidden")
                            }
                            if (strs[i] == "1008") {
                                $("#threadNumErr").text("不能为空")
                                $("#threadNumErr").removeClass("hidden")
                            }
                            if (strs[i] == "1009") {
                                $("#threadNumErr").text("非法字符或数字超出范围")
                                $("#threadNumErr").removeClass("hidden")
                            }
                            if (strs[i] == "1010") {
                                $("#repeatTimeErr").text("不能为空")
                                $("#repeatTimeErr").removeClass("hidden")
                            }
                            if (strs[i] == "1011") {
                                $("#repeatTimeErr").text("非法字符或数字超出范围")
                                $("#repeatTimeErr").removeClass("hidden")
                            }
                            if (strs[i] == "1013") {
                                $("#intervalTimeErr").text("非法字符或数字超出范围")
                                $("#intervalTimeErr").removeClass("hidden")
                            }
                            if (strs[i] == "1019") {
                                $.showAlertBox("错误", "请求数据不能为空，请至少添加一条请求数据", true)
                            }
                            if (strs[i] == "1020") {
                                $.showAlertBox("错误", "数据长度有非法字符", true)
                            }
                            if (strs[i] == "1030" || strs[i] == "1031" || strs[i] == "1032" || strs[i] == "1033") {
                                $.showAlertBox("错误", "数据为Int类型时，数据含有非法字符或值溢出", true)
                            }
                            if (strs[i] == "1040") {
                                $.showAlertBox("错误", "数据为Int类型时，数据长度只能为1，2，4，8", true)
                            }
                            if (strs[i] == "1050" || strs[i] == "1051") {
                                $.showAlertBox("错误", "数据为Float类型时，数据含有非法字符或值溢出", true)
                            }
                            if (strs[i] == "1060") {
                                $.showAlertBox("错误", "数据为Float类型时，数据长度只能为4，8", true)
                            }
                            if (strs[i] == "1080") {
                                $.showAlertBox("错误", "未定义的数据类型，请联系管理员", true)
                            }
                        }
                        return
                    }
                    data = data.data
                    $.showAlertBox("成功", data, false)
                },
                error: function (err) {
                    $.loadingEnd()
                    $.showRequestErr(err)
                }
            })
        }
    </script>
{{end}}